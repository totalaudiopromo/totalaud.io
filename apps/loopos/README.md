# LoopOS - Cinematic Creative Operating System

**Phase 4: Cinematic UX + Agentic Flow Engine + Cross-App Surfaces**

LoopOS is an experimental cinematic operating system for artists and creators. It combines Ableton-style timeline visualisation, AI-driven intelligence, and multi-agent orchestration into a seamless creative workflow.

---

## âœ¨ Features (Phase 4)

### 1. Cinematic Canvas with Timeline
- **Ableton-style timeline** with zoomable time grid
- **Playhead animation** with real-time scrubbing
- **Loop regions** for focused creative work
- **Node clips** that stretch across time
- **Sound cues** synced with playhead (Web Audio API)
- **Time controls** with play/pause, zoom, and reset

**Files:**
- `src/canvas/CinematicCanvas.tsx` - Main canvas component
- `src/canvas/Playhead.tsx` - Animated playhead cursor
- `src/canvas/TimeGrid.tsx` - Time markers every 5 seconds
- `src/canvas/TimeControls.tsx` - Zoom and playback controls
- `src/canvas/LoopRegion.tsx` - Loop start/end markers
- `src/canvas/NodeClip.tsx` - Timeline node clips

### 2. Node Inspector (Right Sidebar)
- **Detailed node editing** with title, description, friction, priority
- **Dependency management** for node relationships
- **AI suggestions** for improving nodes
- **Agent actions** to run specific agents on nodes
- **Activity history** showing node changes over time
- **Export to Console** button for cross-app workflows

**Files:**
- `src/inspector/NodeInspector.tsx` - Main inspector component
- `src/inspector/InspectorPanel.tsx` - Node editing panel
- `src/inspector/AgentActions.tsx` - AI suggestions and agent actions
- `src/inspector/NodeHistory.tsx` - Activity timeline

### 3. Auto-Looping (AI Intelligence)
- **Runs every 12 hours** (configurable)
- **Analyses all nodes** and momentum trends
- **Generates new node suggestions** based on creative themes
- **Suggests dependencies** between existing nodes
- **Provides actionable insights** and micro-actions
- **Identifies emerging themes** in your creative work
- **Auto-adjusts loop parameters** for optimal flow

**Files:**
- `src/agents/AutoLooper.ts` - AI-powered loop analysis
- `src/components/AutoLoopSummary.tsx` - UI for viewing insights
- `src/app/api/auto-loop/route.ts` - API endpoint

**Usage:**
```typescript
import { AutoLooper } from '@/agents/AutoLooper'

const autoLooper = new AutoLooper()
const analysis = await autoLooper.analyseLoops(nodes, userId)

// Returns: momentum, trend, suggestedNodes, suggestedActions, etc.
```

### 4. Agent Orchestration Engine
- **Multi-agent workflows** with sequential or parallel execution
- **Predefined templates** for common tasks:
  - Release Planner
  - PR Cycle Generator
  - 30-Day Growth Loop
- **Custom orchestration builder** for creating your own workflows
- **Dependency management** between orchestration steps
- **Real-time execution** with status tracking
- **Result passthrough** between agent steps

**Files:**
- `src/agents/AgentOrchestrator.ts` - Orchestration engine
- `src/orchestrations/OrchestrationBuilder.tsx` - Build custom workflows
- `src/orchestrations/OrchestrationList.tsx` - View and run orchestrations

**Example orchestration:**
```typescript
const orchestration = {
  name: 'Release Planner',
  steps: [
    { agentRole: 'create', action: 'Generate release concept' },
    { agentRole: 'promote', action: 'Develop promo strategy', dependsOn: ['step-1'] },
    { agentRole: 'analyse', action: 'Analyse target audience', dependsOn: ['step-1'] },
    { agentRole: 'refine', action: 'Refine strategy', dependsOn: ['step-2', 'step-3'] },
  ]
}
```

### 5. Loop Journal
- **Daily creative journal** with Notion-style editor
- **AI-generated summaries** of your creative day
- **Blocker identification** for challenges and obstacles
- **Emerging theme tracking** across journal entries
- **Tomorrow's 5 Actions** generated by AI
- **Momentum tracking** integrated with main system
- **Node linking** to connect journal entries with creative work

**Files:**
- `src/journal/JournalPage.tsx` - Main journal interface
- `src/journal/JournalEditor.tsx` - Rich text editor
- `src/journal/JournalInsights.tsx` - AI insights sidebar
- `src/app/api/journal/insights/route.ts` - AI insights API

**Usage:**
```typescript
// Journal entry structure
interface JournalEntry {
  date: Date
  content: string
  aiSummary?: string
  blockers?: string[]
  themes?: string[]
  momentum?: number
  linkedNodes?: string[]
  tomorrowActions?: string[]
}
```

### 6. Creative Mode (Immersive Flow UI)
- **Distraction-free interface** with dimmed chrome
- **Ambient background pulses** using Framer Motion
- **Floating particles** for atmospheric effect
- **Radial gradient glows** that pulse gently
- **Toggle on/off** with keyboard shortcut
- **Maintains full functionality** while creating calm focus

**Files:**
- `src/modes/CreativeMode.tsx` - Ambient effects wrapper
- `src/modes/CreativeModeToggle.tsx` - Toggle button component

**Activation:**
Click the "Creative Mode" toggle in the header or press `Cmd/Ctrl + Shift + F`

### 7. Cross-App Surfaces (Preview)
- **Console integration preview** - Shows what data LoopOS can send to Console
- **Audio Intel integration preview** - Shows audience analysis requests
- **Example pipelines** demonstrating data flow
- **Schema definitions** for type-safe integrations
- **Implementation notes** for future development

**Files:**
- `src/surfaces/SurfaceDefinitions.ts` - Data schemas and pipelines
- `src/surfaces/ConsoleSurface.tsx` - Console integration preview
- `src/surfaces/AudioIntelSurface.tsx` - Audio Intel integration preview

**âš ï¸ Important:** These are preview-only. No actual API calls are made.

---

## ğŸ—„ï¸ Database Schema

### Tables Created
- `loop_nodes` - Creative nodes in the system
- `journal_entries` - Daily creative journal entries
- `orchestrations` - Multi-agent workflow definitions

### Migration
```bash
# Apply migration
supabase db push

# Generate TypeScript types
pnpm db:types
```

**Migration file:** `supabase/migrations/20251115000000_create_loopos_tables.sql`

---

## ğŸ—ï¸ Architecture

### Tech Stack
- **Framework:** Next.js 15 (App Router)
- **React:** 18.3.1
- **TypeScript:** 5.6.3 (strict mode)
- **Styling:** Tailwind CSS 3.4.1
- **Animation:** Framer Motion 11.11.17
- **State:** Zustand 5.0.2
- **Database:** Supabase
- **AI:** Anthropic Claude Sonnet 4.5

### Design System
- **Colours:** Matte Black (#0F1113), Slate Cyan (#3AA9BE)
- **Motion Tokens:** 120ms (micro), 240ms (transition), 400ms (ambient)
- **Typography:** -apple-system, BlinkMacSystemFont, Segoe UI
- **Easing:** cubic-bezier(0.22, 1, 0.36, 1)

### Project Structure
```
apps/loopos/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/               # API routes
â”‚   â”‚   â”œâ”€â”€ journal/           # Journal page
â”‚   â”‚   â”œâ”€â”€ orchestrations/    # Orchestrations page
â”‚   â”‚   â”œâ”€â”€ surfaces/          # Cross-app surfaces
â”‚   â”‚   â””â”€â”€ page.tsx           # Main canvas page
â”‚   â”œâ”€â”€ canvas/                 # Timeline canvas components
â”‚   â”œâ”€â”€ inspector/              # Node inspector sidebar
â”‚   â”œâ”€â”€ agents/                 # AI agents (AutoLooper, Orchestrator)
â”‚   â”œâ”€â”€ orchestrations/         # Orchestration builder UI
â”‚   â”œâ”€â”€ journal/                # Journal editor and insights
â”‚   â”œâ”€â”€ modes/                  # Creative mode
â”‚   â”œâ”€â”€ surfaces/               # Cross-app integration surfaces
â”‚   â”œâ”€â”€ stores/                 # Zustand state management
â”‚   â”œâ”€â”€ types/                  # TypeScript type definitions
â”‚   â””â”€â”€ lib/                    # Utilities
â””â”€â”€ package.json

packages/loopos-db/             # Supabase database utilities
â””â”€â”€ src/
    â”œâ”€â”€ client.ts              # Supabase client
    â”œâ”€â”€ nodes.ts               # Node CRUD operations
    â”œâ”€â”€ journal.ts             # Journal CRUD operations
    â”œâ”€â”€ orchestrations.ts      # Orchestration CRUD operations
    â””â”€â”€ types.ts               # Database type schemas
```

---

## ğŸš€ Development

### Prerequisites
- Node.js 18+
- pnpm 8+
- Supabase account

### Setup
```bash
# Install dependencies
pnpm install

# Set up environment variables
cp apps/loopos/.env.example apps/loopos/.env.local

# Run database migrations
pnpm db:migrate

# Start development server
pnpm dev

# LoopOS will be available at http://localhost:3001
```

### Environment Variables
```bash
# Required
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
ANTHROPIC_API_KEY=your-anthropic-key

# Optional
NEXT_PUBLIC_APP_URL=http://localhost:3001
NODE_ENV=development
```

### Build & Deploy
```bash
# Build for production
pnpm build

# Start production server
pnpm start
```

---

## ğŸ¯ Usage Guide

### Creating Nodes
1. Click anywhere on the timeline canvas
2. Select node type (create/promote/analyse/refine)
3. Set time position and duration
4. Edit details in Node Inspector

### Running Auto-Loop Analysis
1. Open Auto-Loop Summary modal
2. Click "Run Analysis"
3. Review AI suggestions and insights
4. Apply suggested actions to your loop

### Building Orchestrations
1. Navigate to /orchestrations
2. Choose a template or create custom
3. Add steps with agent roles and actions
4. Run orchestration and track progress

### Using Journal
1. Navigate to /journal
2. Write daily entry
3. Click "Generate Insights" for AI analysis
4. Review blockers, themes, and tomorrow's actions

### Enabling Creative Mode
1. Click Creative Mode toggle in header
2. Enjoy distraction-free ambient interface
3. All functionality remains accessible

---

## ğŸ§ª Testing

```bash
# Run type checking
pnpm typecheck

# Run linting
pnpm lint

# Format code
pnpm format
```

---

## ğŸ“š API Reference

### Auto-Loop API
```typescript
POST /api/auto-loop
```
Runs AI analysis on all user nodes and returns momentum, suggestions, and insights.

**Response:**
```json
{
  "success": true,
  "analysis": {
    "momentum": 75,
    "trend": "increasing",
    "suggestedNodes": [...],
    "suggestedActions": [...],
    "microActions": [...],
    "emergingThemes": [...]
  }
}
```

### Journal Insights API
```typescript
POST /api/journal/insights
Content-Type: application/json

{
  "content": "Today I worked on..."
}
```

**Response:**
```json
{
  "summary": "Two sentence summary...",
  "blockers": ["Blocker 1", "Blocker 2"],
  "themes": ["Theme 1", "Theme 2"],
  "tomorrowActions": ["Action 1", "Action 2", ...]
}
```

---

## ğŸ¨ Design Philosophy

LoopOS follows these principles:

1. **Cinematic Experience** - Every interaction feels intentional and beautiful
2. **AI-Augmented Creativity** - Intelligence that enhances, not replaces, human creativity
3. **Flow State Optimisation** - Design decisions prioritise uninterrupted creative flow
4. **Transparent Intelligence** - AI insights are visible and explainable
5. **Calm Technology** - Ambient, non-intrusive interface that fades when not needed

---

## ğŸ”® Future Roadmap

- **Phase 5:** Real-time collaboration with presence system
- **Phase 6:** Integration with Console and Audio Intel
- **Phase 7:** Mobile companion app
- **Phase 8:** Plugin system for custom agents

---

## ğŸ“ License

Private - Experimental Project

---

## ğŸ¤ Contributing

This is an experimental sandbox project. Contributions are welcome but please discuss major changes first.

---

**Built with â¤ï¸ for artists and creators**
